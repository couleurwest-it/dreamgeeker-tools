
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>toolbox.cfgmng &#8212; Documentation dreamtools 1</title>
    <link href="../../_static/pygments.css" rel="stylesheet" type="text/css" />
    <link href="../../_static/haiku.css" rel="stylesheet" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/translations.js"></script>
    <link href="../../genindex.html" rel="index" title="Index" />
    <link href="../../search.html" rel="search" title="Recherche" />
  </head><body>
      <div class="header" role="banner"><img alt="Logo" class="rightlogo" src="../../_static/favicon2.png"/><h1 class="heading"><a href="../../index.html">
          <span>Documentation dreamtools 1</span></a></h1>
        <h2 class="heading"><span>toolbox.cfgmng</span></h2>
      </div>
      <div aria-label="top navigation" class="topnav" role="navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contenu</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Code source de toolbox.cfgmng</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># cfgmng.py</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Gestion fichiers de configurations (YAML)</span>

<span class="sd">pathfile : toolbox/cfgmng.py</span>

<span class="sd">Repertoires par défaut</span>
<span class="sd">----------------------</span>
<span class="sd">.. note::</span>
<span class="sd">    * PROJECT_DIR/cfg/PROJECT_DIR/cfg/.log.yml : Fichier de configuration des logs</span>
<span class="sd">    * PROJECT_DIR/cfg/.app.yml : Fichier de configuration de l&#39;application</span>
<span class="sd">    * PROJECT_DIR/cfg/categorie.yml : Fichier de liste définie par un code et un libelle</span>
<span class="sd">    * PROJECT_DIR/cfg/mailing.yml : Fichier de mails préparés</span>
<span class="sd">    * PROJECT_DIR/cfg/validators.yml : Fichier de validation(cf CERBERUS)</span>
<span class="sd">    * PROJECT_DIR/cfg/normalizor.yml : Fichier de normalization(cf CERBERUS)</span>

<span class="sd">Class CFBases</span>
<span class="sd">-------------</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">yaml</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">yaml</span> <span class="kn">import</span> <span class="n">CLoader</span> <span class="k">as</span> <span class="n">Loader</span><span class="p">,</span> <span class="n">CDumper</span> <span class="k">as</span> <span class="n">Dumper</span><span class="p">,</span> <span class="n">CSafeLoader</span> <span class="k">as</span> <span class="n">SafeLoader</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">yaml</span> <span class="kn">import</span> <span class="n">Loader</span><span class="p">,</span> <span class="n">Dumper</span><span class="p">,</span> <span class="n">SafeLoader</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tools</span>


<span class="k">class</span> <span class="nc">CFGEngine</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    cfg engine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__dir_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="n">baz_dir</span><span class="o">=</span><span class="s1">&#39;cfg&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param str baz_dir:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CFGEngine</span><span class="o">.</span><span class="n">__dir_path</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">PROJECT_DIR</span><span class="p">,</span> <span class="n">baz_dir</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">working_directory</span><span class="p">(</span><span class="n">sub_dir</span><span class="p">):</span>
        <span class="n">CFGEngine</span><span class="o">.</span><span class="n">initial</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFGEngine</span><span class="o">.</span><span class="n">__dir_path</span><span class="p">,</span> <span class="n">sub_dir</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loading</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Récupération des parametres de configuration du fichier &lt;filepath&gt; section &lt;r&gt;</span>

<span class="sd">        :param str filepath: Fichier de configuration</span>
<span class="sd">        :param str code: référence parametres à récupérer, optionnel</span>
<span class="sd">        :param str mode: bytes par defaut</span>
<span class="sd">        :return: configuration | None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tools</span><span class="o">.</span><span class="n">file_exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg</span><span class="p">:</span>
                    <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">SafeLoader</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span>
                        <span class="n">cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span><span class="p">:</span>
                        <span class="n">cfg</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

                    <span class="n">config</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">if</span> <span class="n">code</span> <span class="k">else</span> <span class="n">cfg</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[Chargement du fichier </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_cfg</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enregistrement d&#39; un fichier</span>
<span class="sd">        ========================================</span>

<span class="sd">        :param dict[str:str]|list[] d: données à enregistrer</span>
<span class="sd">        :param str f: nom du fichier</span>
<span class="sd">        :param str m, default (write): mode &quot;w|a&quot;, optional</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">dir_parent</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_yml</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">f_yml</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span>


<div class="viewcode-block" id="CFGBases"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases">[docs]</a><span class="k">class</span> <span class="nc">CFGBases</span><span class="p">(</span><span class="n">CFGEngine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cette class permet de gere des fichiers de configuration disponibles dans le repertoire &lt;PROJET_DIR&gt;/cfg</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CFG_DIR</span> <span class="o">=</span> <span class="n">CFGEngine</span><span class="o">.</span><span class="n">working_directory</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># databases parameters</span>
    <span class="n">__logs</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFG_DIR</span><span class="p">,</span> <span class="s1">&#39;.log.yml&#39;</span><span class="p">)</span>
    <span class="n">__app</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFG_DIR</span><span class="p">,</span> <span class="s1">&#39;.app.yml&#39;</span><span class="p">)</span>
    <span class="n">__categories</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFG_DIR</span><span class="p">,</span> <span class="s1">&#39;categorie.yml&#39;</span><span class="p">)</span>
    <span class="n">__mail</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFG_DIR</span><span class="p">,</span> <span class="s1">&#39;mailing.yml&#39;</span><span class="p">)</span>
    <span class="n">__validator</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFG_DIR</span><span class="p">,</span> <span class="s1">&#39;validators.yml&#39;</span><span class="p">)</span>  <span class="c1"># databases parameters</span>
    <span class="n">__normalisator</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">path_build</span><span class="p">(</span><span class="n">CFG_DIR</span><span class="p">,</span> <span class="s1">&#39;normalizor.yml&#39;</span><span class="p">)</span>  <span class="c1"># databases parameters</span>

<div class="viewcode-block" id="CFGBases.logs_cfg"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases.logs_cfg">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">logs_cfg</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot; Configuration des logs</span>

<span class="sd">        :Exemple:</span>
<span class="sd">            &gt;&gt;&gt; import import logging.config as log_config</span>
<span class="sd">            &gt;&gt;&gt; import logging</span>
<span class="sd">            &gt;&gt;&gt; log_config.dictConfig(CFGBases.logs_cfg())</span>
<span class="sd">            &gt;&gt;&gt; tracker = logging.getLogger(&#39;PROD|TEST&#39;)</span>
<span class="sd">            &gt;&gt;&gt; tracker.info(&quot;Exemple dun message d&#39;information&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">CFGBases</span><span class="o">.</span><span class="n">loading</span><span class="p">(</span><span class="n">CFGBases</span><span class="o">.</span><span class="n">__logs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CFGBases.app_cfg"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases.app_cfg">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">app_cfg</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Parametres application</span>

<span class="sd">        :param str code: clé a retourner (filtre)</span>
<span class="sd">        :return: Configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CFGBases</span><span class="o">.</span><span class="n">loading</span><span class="p">(</span><span class="n">CFGBases</span><span class="o">.</span><span class="n">__app</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></div>

<div class="viewcode-block" id="CFGBases.validator"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases.validator">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot; Parametres de validation de formulaire</span>

<span class="sd">        :param str code: référence du formulaire</span>
<span class="sd">        :return: parametres de validation</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CFGBases</span><span class="o">.</span><span class="n">loading</span><span class="p">(</span><span class="n">CFGBases</span><span class="o">.</span><span class="n">__validator</span><span class="p">)</span></div>

<div class="viewcode-block" id="CFGBases.normalizor"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases.normalizor">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">normalizor</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot; Parametres de normalisation de formulaire</span>
<span class="sd">        :return: parametres de normaisation</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CFGBases</span><span class="o">.</span><span class="n">loading</span><span class="p">(</span><span class="n">CFGBases</span><span class="o">.</span><span class="n">__normalisator</span><span class="p">)</span></div>

<div class="viewcode-block" id="CFGBases.mailing_lib"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases.mailing_lib">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">mailing_lib</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mail préparé</span>

<span class="sd">        :param str code: référence du mail à envoyer</span>
<span class="sd">        :return: mail</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CFGBases</span><span class="o">.</span><span class="n">loading</span><span class="p">(</span><span class="n">CFGBases</span><span class="o">.</span><span class="n">__mail</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></div>

<div class="viewcode-block" id="CFGBases.categorie_lib"><a class="viewcode-back" href="../../classes/cfgloader.html#toolbox.cfgmng.CFGBases.categorie_lib">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">categorie_lib</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Liste de definition</span>

<span class="sd">        :param str code: référence du de la liste</span>
<span class="sd">        :return: liste(s) de categories</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CFGBases</span><span class="o">.</span><span class="n">loading</span><span class="p">(</span><span class="n">CFGBases</span><span class="o">.</span><span class="n">__categories</span><span class="p">)</span></div></div>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CFGBases&#39;</span><span class="p">]</span>
</pre></div>

      </div>
      <div aria-label="bottom navigation" class="bottomnav" role="navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contenu</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, dreamgeeker.
    </div>
  </body>
</html>